<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/b79636be-b088-48b5-8a8d-c21645d26d2fCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>WCF Chat Sample</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>WCF Chat Sample</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            WCF
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Chat
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">11/28/2011</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/WCF-Chat-Sample-0b7f5042">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>WCF Chat Sample</h1>
<div id="mainSection">
<div id="mainBody">
<div class="saveHistory" id="allHistory">
<p>&nbsp;</p>
</div>
<div class="introduction">
<p>&nbsp;</p>
<h3 class="procedureSubHeading">To get samples and instructions for installing them</h3>
<div class="subSection">
<ul>
<li>
<p>Do one or more of the following:</p>
<ul>
<li>
<p>On the <span class="ui">Help</span> menu, click <span class="ui">Samples</span>.</p>
<p>The Readme displays information about samples.</p>
</li><li>
<p>Visit the Visual Studio 2008 Samples Web site. The most recent versions of samples are available there.</p>
</li><li>
<p>Locate samples on the computer on which Visual Studio is installed. By default, samples and a Readme file are installed in
<span class="placeholder">drive</span>:\Program Files\Microsoft Visual Studio 9.0\Samples\<span class="placeholder">lcid</span>. For Express editions of Visual Studio, all samples are located online.</p>
</li></ul>
</li></ul>
<p>For more information, see .</p>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="alert">
<table width="100%">
</table>
</div>
<p>&nbsp;</p>
</div>
<h3 class="procedureSubHeading">To run the sample</h3>
<div class="subSection">
<ol>
<li>
<p>In <span class="ui">Solution Explorer</span>, open the .sln file.</p>
<p>Whenever a step refers to a client or a service, those steps apply to separate instances of the sample (because the Chat sample is not a client and service application).</p>
</li><li>
<p>Press F5 to run the Chat application.</p>
</li><li>
<p>Start as many instances (named instance and located in <span class="placeholder">
Visual Basic installation path</span>\Projects\Chat\Instance\Bin\Debug\Instance.exe) as you want. Start by entering a nickname that will distinguish messages sent from a particular client instance. Shortly after this name is entered, chat messages can be sent
 to the mesh. These messages should be sent to all the other instances that have a distinct member name. (That is, a message from a client that has the same name will not be displayed, and a single client's own message will not be sent to the console window
 of that client.)</p>
</li></ol>
</div>
<h1 class="heading"><span>Demonstrates</span></h1>
<div class="section" id="demonstratesSection">
<p>The Chat sample is not a client and service application. It is a true peer-to-peer application, in which each instance acts as a peer of other instances. Each instance can send messages to other instances and receive messages from other instances by using
 the IChat duplex contract.</p>
<h1 class="heading"><span>Key Concepts</span></h1>
<div class="section" id="sectionSection0">
<p>PeerChannel is a multiparty, peer-to-peer (P2P) communication technology in Windows Communication Foundation (WCF). It helps to enable secure, scalable, and reliable messaging. One common example of a multiparty application that can benefit from PeerChannel
 is a collaborative application such as chat. In chat, a group of people communicate with one another in a peer-to-peer manner without servers. PeerChannel enables P2P collaboration, content distribution, load balancing, and distributed processing for both
 consumer and enterprise scenarios.</p>
<p>PeerChannel introduces the following new concepts:</p>
<ul>
<li>
<p>A <span class="term">mesh</span> is a named collection (an interconnected graph) of peer nodes that can communicate among themselves and that are each identified by a unique mesh ID.</p>
<div class="alert">
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th align="left"><strong>Note:</strong></th>
</tr>
<tr>
<td>
<p>Active nodes in the mesh publish their mesh names so that others can find them. A mesh adjusts to changing membership, it has adaptable connectivity in an environment in which nodes are constantly joining and leaving the mesh, and it is dynamically optimized
 to adapt to traffic patterns.</p>
</td>
</tr>
</tbody>
</table>
</div>
</li><li>
<p>Active nodes in the mesh publish their mesh names so that others can find them. A mesh adjusts to changing membership, it has adaptable connectivity in an environment in which nodes are constantly joining and leaving the mesh, and it is dynamically optimized
 based on traffic patterns.</p>
</li><li>
<p>A <span class="term">peer node</span> is an endpoint in a mesh. A single application can have multiple peer nodes that participate in different meshes.</p>
</li><li>
<p>A peer resolver is responsible for resolving a mesh ID to the endpoint addresses of the nodes in the mesh. A peer node uses these addresses to connect to other nodes in the mesh. This enables messages to be propagated throughout the mesh.</p>
</li></ul>
<p>Chat is a Windows Forms application. Each instance of a Chat application creates an IDuplexChannel that has the same endpoint address. Because all instances of a Chat application use the same address, a message that is sent by one instance of the application
 is received by all other instances on its peer channel.</p>
<p>The Chat application defines and implements the IChat duplex contract. The IChat contract allows for only one-way operations because the ServiceModel does not support the single-request/multiple-response paradigm. (In a multiparty channel, a single request
 that is sent to the mesh can generate multiple responses.)</p>
<p>This sample implements a static Main function to create an IClientChannel with the IChat duplex contract. The function uses the endpoint that is specified in the configuration file.</p>
<p>All Chat instances must use the same endpoint address to ensure that the messages sent by one instance are received by all other instances.</p>
<p>Chat instances in this sample locate each other either by using a custom resolver or by using the default peer resolver (PNRP). Note that PNRP is not available on Windows Server 2003. Therefore, a custom resolver must be used to run this sample on a system
 that is running Windows Server 2003. By default, this sample is set up to use a custom resolver. Whether a custom resolver or the default resolver is used is determined by the chat endpoint defined in the following configuration file. To switch to the default
 peer resolver (PNRP), replace <span class="code">BindingCustomResolver</span> with
<span class="code">BindingDefault</span> under <span class="code">bindingConfiguration</span> in the sample's configuration file.</p>
<div class="code"><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<td colspan="2">
<pre>&lt;!-- Chat instance participating in the mesh. --&gt;
         &lt;endpoint name=&quot;ChatEndpoint&quot;
                   address=&quot;net.p2p://chatMesh/ServiceModelSamples/Chat&quot; 
                   binding=&quot;netPeerTcpBinding&quot; 
                   bindingConfiguration=&quot;BindingCustomResolver&quot; 
                   contract=&quot;Microsoft.ServiceModel.Samples.IChat&quot;&gt;
         &lt;/endpoint&gt;</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>To enable the peer node to communicate with the Peer Channel Custom Peer Resolver service, the client-side configuration of the Peer Channel Custom Peer Resolver is defined in the configuration file.</p>
<div class="code"><span>
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<td colspan="2">
<pre>&lt;!-- Client used to communicate with the custom resolver service. --&gt;
&lt;client&gt;
&lt;endpoint configurationName=&quot;CustomPeerResolverEndpoint&quot;
address=&quot;net.tcp://localhost/ServiceModelsamples/peerResolverService&quot;
    binding=&quot;netTcpBinding&quot;
    bindingConfiguration=&quot;Binding3&quot;
    contract=&quot;Microsoft.ServiceModel.SamplesICustomPeerResolver&quot;&gt;
&lt;/endpoint&gt;
&lt;/client&gt;</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
<p>The address identifies the address of the resolver service. If the resolver service is running on a remote computer, replace
<span class="code">localhost</span> with a qualified domain name.</p>
<p>The sample also demonstrates how to retrieve the peer node from IClientChannel and how to register for online and offline events by using IOnlineStatus. An online event is initiated when the peer node is connected to at least one other peer node in the mesh.
 An offline event is initiated when the peer node is no longer connected to any other peer node in the mesh.</p>
<p>Currently, metadata cannot be generated because a peer channel is not integrated with the service metadata utility (Svcutil.exe).</p>
<p>When you run the sample, the chat messages sent by a Chat instance are displayed in the console windows of other Chat instances. Press the Q key followed by ENTER in each console window to close the instance.</p>
<div class="alert">
<table cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<th align="left"><strong>Note:</strong></th>
</tr>
<tr>
<td>
<p>The sample currently does not handle all possible exceptions that the infrastructure may throw. If you are using these samples in a commercial or production environment, follow the appropriate exception-handling best practices.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div class="footerLine"></div>
<a name="feedback"></a><span id="fb" class="feedbackcss">&nbsp;</span></div>
</div>

</div>


    </div>
</body>
</html>
